import{I as L,_ as pe,r as R,b as f,N as me,d as o,o as _,e as P,f as e,w as u,g as a,F as z,q as G,s as x,K as M,R as ce,k as Y,i as O,t as _e,n as X,L as K,O as ne,y as ge,D as fe,v as ee}from"./index-cc972ea5.js";const Se=(g,A,V)=>L({method:"get",url:`/admin/product/${g}/${A}?category3Id=${V}`}),ae=()=>L({method:"get",url:"/admin/product/baseTrademark/getTrademarkList"}),oe=g=>L({method:"get",url:`/admin/product/spuImageList/${g}`}),ue=()=>L({method:"get",url:"/admin/product/baseSaleAttrList"}),se=g=>L({method:"get",url:`/admin/product/spuSaleAttrList/${g}`}),be=g=>g.id?L({method:"post",url:"/admin/product/updateSpuInfo",data:g}):L({method:"post",url:"/admin/product/saveSpuInfo",data:g}),ye=g=>L({method:"post",url:"/admin/product/saveSkuInfo",data:g}),Ve=g=>L({method:"get",url:`/admin/product/findBySpuId/${g}`}),ke=g=>L({method:"delete",url:`/admin/product/deleteSpu/${g}`});const ve=["src"],Ie={__name:"SpuForm",emits:["controlViewState"],setup(g,{expose:A,emit:V}){let k=R({}),S=f(),w=R([]),b=R([]),s=f();const h=()=>{V("controlViewState",{state:1})};let m=R({id:null,category3Id:null,description:null,spuName:null,tmId:null,spuImageList:[],spuSaleAttrList:[]});A({getBaseSelect:async l=>{Object.assign(m,{id:null,category3Id:l,description:null,spuName:null,tmId:null,spuImageList:[],spuSaleAttrList:[]}),S.value=[],b=R([]);let t=await ae();t.code==200&&Object.assign(k,t.data);let y=await ue();y.code==200&&Object.assign(w,y.data)},getFullSpuData:async l=>{Object.assign(m,l);let t=await ae();t.code==200&&Object.assign(k,t.data);let y=await oe(l.id);y.code==200&&(S.value=y.data.map((F,Q,c)=>({name:F.imgName,url:F.imgUrl})));let v=await ue();v.code==200&&Object.assign(w,v.data);let D=await se(l.id);D.code==200&&Object.assign(b,D.data)}});let I=f(!1),U=f(),r=l=>{I.value=!0,U.value=l.url},C=(l,t)=>{l.spuSaleAttrValueList.splice(t,1)},i=me(()=>w.filter(l=>b.every(t=>l.name!==t.saleAttrName))),T=()=>{b.push({baseSaleAttrId:w.find(l=>l.name==s.value).id,saleAttrName:s.value,spuSaleAttrValueList:[]}),s.value=null},E=l=>{b.splice(l,1)},p=(l,t)=>{t.flag=!0,t.SaleArrValue=""},d=l=>{const{SaleArrValue:t,baseSaleAttrId:y}=l;if(!t.trim()){K({type:"error",message:"不能为空"});return}if(l.spuSaleAttrValueList.find(D=>D.saleAttrValueName==t)){K({type:"error",message:"不能重复"});return}l.spuSaleAttrValueList.push({saleAttrValueName:t,baseSaleAttrId:y}),l.SaleArrValue="",l.flag=!1};const q={mounted(l){l.querySelector("input").focus()}},N=async()=>{m.spuImageList=S.value.map((t,y,v)=>({imgName:t.name,imgUrl:t.response&&t.response.data||t.url})),m.spuSaleAttrList=b,(await be(m)).code==200?(K({type:"success",message:m.id?"修改成功":"添加成功"}),V("controlViewState",{state:1,AddOrUpdate:m.id?"update":"add"})):K({type:"error",message:m.id?"修改失败":"添加失败"})};return(l,t)=>{const y=o("el-input"),v=o("el-form-item"),D=o("el-option"),F=o("el-select"),Q=o("el-icon"),c=o("el-upload"),Z=o("el-dialog"),H=o("SvgIcon"),$=o("el-button"),W=o("el-table-column"),re=o("el-tag"),de=o("el-table"),ie=o("el-form");return _(),P("div",null,[e(ie,null,{default:u(()=>[e(v,{label:"SPU名称"},{default:u(()=>[e(y,{placeholder:"请输入SPU名称",modelValue:a(m).spuName,"onUpdate:modelValue":t[0]||(t[0]=n=>a(m).spuName=n)},null,8,["modelValue"])]),_:1}),e(v,{label:"SPU品牌"},{default:u(()=>[e(F,{placeholder:"请选择你的品牌",modelValue:a(m).tmId,"onUpdate:modelValue":t[1]||(t[1]=n=>a(m).tmId=n)},{default:u(()=>[(_(!0),P(z,null,G(a(k),n=>(_(),x(D,{key:n.id,label:n.tmName,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"SPU描述"},{default:u(()=>[e(y,{type:"textarea",placeholder:"请输入SPU描述",modelValue:a(m).description,"onUpdate:modelValue":t[2]||(t[2]=n=>a(m).description=n)},null,8,["modelValue"])]),_:1}),e(v,{label:"SPU图标"},{default:u(()=>[e(c,{"file-list":a(S),"onUpdate:fileList":t[3]||(t[3]=n=>M(S)?S.value=n:S=n),action:"http://sph-api.atguigu.cn/admin/product/fileUpload","list-type":"picture-card","on-preview":a(r)},{default:u(()=>[e(Q,null,{default:u(()=>[e(a(ce))]),_:1})]),_:1},8,["file-list","on-preview"]),e(Z,{modelValue:a(I),"onUpdate:modelValue":t[4]||(t[4]=n=>M(I)?I.value=n:I=n)},{default:u(()=>[Y("img",{"w-full":"",src:a(U),alt:"Preview Image",style:{width:"100%"}},null,8,ve)]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"SPU销售属性"},{default:u(()=>[e(F,{placeholder:a(i).length<a(w).length?`还可选择${a(w).length-a(b).length}个`:"暂无可选",modelValue:a(s),"onUpdate:modelValue":t[5]||(t[5]=n=>M(s)?s.value=n:s=n)},{default:u(()=>[(_(!0),P(z,null,G(a(i),n=>(_(),x(D,{key:n.id,label:n.name,value:n.name},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]),e($,{disabled:!(a(i).length&&a(s)),type:"primary",style:{"margin-left":"20px"},onClick:a(T)},{default:u(()=>[e(H,{class:"svg no_margin",name:"add"}),O(" 添加属性 ")]),_:1},8,["disabled","onClick"]),e(de,{border:"",data:a(b),style:{margin:"10px 0"}},{default:u(()=>[e(W,{label:"序号",type:"index",width:"80"}),e(W,{label:"销售属性名字",prop:"saleAttrName"}),e(W,{label:"销售属性值"},{default:u(({row:n,column:le,$index:te})=>[(_(!0),P(z,null,G(n.spuSaleAttrValueList,j=>(_(),x(re,{key:j.id,class:"mx-1",closable:"",onClose:he=>a(C)(n,te)},{default:u(()=>[O(_e(j.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),n.flag?X((_(),x(y,{key:0,onBlur:j=>a(d)(n),modelValue:n.SaleArrValue,"onUpdate:modelValue":j=>n.SaleArrValue=j,placeholder:"请输入属性值",type:"small",style:{width:"100px"}},null,8,["onBlur","modelValue","onUpdate:modelValue"])),[[q]]):(_(),x($,{key:1,onClick:j=>a(p)(j,n),type:"success",size:"small"},{default:u(()=>[e(H,{class:"svg no_margin",name:"add"})]),_:2},1032,["onClick"]))]),_:1}),e(W,{label:"操作"},{default:u(({row:n,$index:le})=>[e($,{type:"danger",size:"small",onClick:te=>a(E)(le)},{default:u(()=>[e(H,{class:"svg no_margin",name:"shanchu"})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(v,null,{default:u(()=>[e($,{type:"primary",onClick:N},{default:u(()=>[O("保存")]),_:1}),e($,{onClick:h},{default:u(()=>[O("取消")]),_:1})]),_:1})]),_:1})])}}},Ue=pe(Ie,[["__scopeId","data-v-fc38cae9"]]),Ce=["src"],we={__name:"SkuForm",emits:["controlViewState"],setup(g,{expose:A,emit:V}){let k=ne(),S=f(),w=f(),b=f(),s=f({category3Id:0,spuId:0,tmId:0,skuName:null,price:null,weight:null,skuDesc:null,skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:null}),h=f();const m=()=>{V("controlViewState",{state:1})};A({getBaseData:async U=>{s.value={category3Id:0,spuId:0,tmId:0,skuName:null,price:null,weight:null,skuDesc:null,skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:null},s.value.category3Id=k.C3Id,s.value.spuId=U.id,s.value.tmId=U.tmId,await k.getCategoryData();let r=k.CategoryData;S.value=r;let C=await se(U.id);w.value=C.data;let i=await oe(U.id);b.value=i.data}});const B=U=>{h.value.clearSelection(),h.value.toggleRowSelection(U,!0),s.value.skuDefaultImg=U.imgUrl};let I=async()=>{s.value.skuAttrValueList=S.value.filter((r,C,i)=>!!r.currentId).map((r,C,i)=>{if(r.currentId)return{attrId:r.id,valueId:r.currentId}}),s.value.skuSaleAttrValueList=w.value.filter((r,C,i)=>!!r.currentId).map((r,C,i)=>{if(r.currentId)return{saleAttrId:r.id,saleAttrValueId:r.currentId}}),(await ye(s.value)).code==200?(K({type:"success",message:"添加SKU成功"}),V("controlViewState",{state:1})):K({type:"success",message:"添加SKU成功"})};return(U,r)=>{const C=o("el-input"),i=o("el-form-item"),T=o("el-option"),E=o("el-select"),p=o("el-form"),d=o("el-table-column"),q=o("el-button"),N=o("el-table");return _(),x(p,{"label-width":"100px"},{default:u(()=>[e(i,{label:"SKU名称"},{default:u(()=>[e(C,{modelValue:a(s).skuName,"onUpdate:modelValue":r[0]||(r[0]=l=>a(s).skuName=l),placeholder:"SKU名称"},null,8,["modelValue"])]),_:1}),e(i,{label:"价格(元)"},{default:u(()=>[e(C,{modelValue:a(s).price,"onUpdate:modelValue":r[1]||(r[1]=l=>a(s).price=l),placeholder:"价格(元)"},null,8,["modelValue"])]),_:1}),e(i,{label:"重量(g)"},{default:u(()=>[e(C,{modelValue:a(s).weight,"onUpdate:modelValue":r[2]||(r[2]=l=>a(s).weight=l),placeholder:"重量(g)"},null,8,["modelValue"])]),_:1}),e(i,{label:"SKU描述"},{default:u(()=>[e(C,{modelValue:a(s).skuDesc,"onUpdate:modelValue":r[3]||(r[3]=l=>a(s).skuDesc=l),type:"textarea",placeholder:"SKU描述"},null,8,["modelValue"])]),_:1}),e(i,{label:"平台属性"},{default:u(()=>[e(p,{inline:!0,"label-width":"100"},{default:u(()=>[(_(!0),P(z,null,G(a(S),l=>(_(),x(i,{label:l.attrName,key:l.id},{default:u(()=>[e(E,{modelValue:l.currentId,"onUpdate:modelValue":t=>l.currentId=t},{default:u(()=>[(_(!0),P(z,null,G(l.attrValueList,t=>(_(),x(T,{label:t.valueName,value:t.id,key:t.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(i,{label:"销售属性"},{default:u(()=>[e(p,{inline:!0},{default:u(()=>[(_(!0),P(z,null,G(a(w),l=>(_(),x(i,{label:l.saleAttrName,key:l.id},{default:u(()=>[e(E,{modelValue:l.currentId,"onUpdate:modelValue":t=>l.currentId=t},{default:u(()=>[(_(!0),P(z,null,G(l.spuSaleAttrValueList,t=>(_(),x(T,{label:t.saleAttrValueName,value:t.id,key:t.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(i,{label:"图片名称"},{default:u(()=>[e(N,{ref_key:"table",ref:h,border:"",data:a(b)},{default:u(()=>[e(d,{type:"selection",align:"center",width:"80"}),e(d,{label:"图片"},{default:u(({row:l,column:t,$index:y})=>[Y("img",{src:l.imgUrl,style:{width:"200px"}},null,8,Ce)]),_:1}),e(d,{label:"名称",prop:"imgName"}),e(d,{label:"操作"},{default:u(({row:l,column:t,$index:y})=>[e(q,{type:"primary",onClick:v=>B(l)},{default:u(()=>[O("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(i,null,{default:u(()=>[e(q,{type:"primary",onClick:r[4]||(r[4]=l=>a(I)())},{default:u(()=>[O("保存")]),_:1}),e(q,{onClick:m},{default:u(()=>[O("取消")]),_:1})]),_:1})]),_:1})}}},Ae=["src"],Le={__name:"index",setup(g){let A=f(1),V=f(1),k=f(1),S=f(3),w=f(1),b=R({records:[]}),s=f(),h=f(!1),m=f(),J=f(),B=ne();ge(()=>B.C3Id,(p,d)=>{p!=null&&I()});let I=async p=>{p&&(k.value=1);let d=await Se(k.value,S.value,B.C3Id);d.code==200&&(Object.assign(b,d.data),w=b.total)},U=()=>{V.value=2,A.value=0,m.value.getBaseSelect(B.C3Id)},r=p=>{V.value=2,A.value=0,m.value.getFullSpuData(p)};const C=p=>{console.log("添加SKU按钮的回调"),V.value=3,A.value=0,J.value.getBaseData(p)},i=p=>{V.value=p.state,A.value=1,p.AddOrUpdate=="add"?I(1):I()},T=async p=>{h.value=!0;let d=await Ve(p.id);d.code==200&&(s.value=d.data)};let E=async p=>{let d=await ke(p.id);d.code==200?(K({type:"success",message:"删除成功"}),b.records.length<=1&&(k-=1),I()):K({type:"error",message:"删除失败:"+d.data})};return fe(()=>{B.$reset()}),(p,d)=>{const q=o("Category"),N=o("SvgIcon"),l=o("el-button"),t=o("el-table-column"),y=o("el-popconfirm"),v=o("el-table"),D=o("el-pagination"),F=o("el-dialog"),Q=o("el-card");return _(),P("div",null,[e(q,{scene:a(A),state:1},null,8,["scene"]),e(Q,{style:{margin:"10px 0"}},{default:u(()=>[X(Y("div",null,[e(l,{type:"primary",disabled:!a(B).C3Id,onClick:a(U)},{default:u(()=>[e(N,{class:"svg no_margin",name:"add"}),O(" 添加SPU ")]),_:1},8,["disabled","onClick"]),e(v,{border:"",style:{margin:"10px 0"},data:a(b).records},{default:u(()=>[e(t,{label:"序号",type:"index",align:"center",width:"100"}),e(t,{label:"SPU名称",prop:"spuName"}),e(t,{label:"SPU描述",prop:"description"}),e(t,{label:"SPU操作"},{default:u(({row:c,column:Z,$index:H})=>[e(l,{type:"primary",onClick:$=>C(c)},{default:u(()=>[e(N,{class:"svg no_margin",name:"add"})]),_:2},1032,["onClick"]),e(l,{type:"primary",onClick:$=>a(r)(c)},{default:u(()=>[e(N,{class:"svg no_margin",name:"bianji"})]),_:2},1032,["onClick"]),e(l,{type:"primary",onClick:$=>T(c)},{default:u(()=>[e(N,{class:"svg no_margin",name:"chakan"})]),_:2},1032,["onClick"]),e(y,{title:"确认删除吗?",onConfirm:$=>a(E)(c)},{reference:u(()=>[e(l,{type:"primary"},{default:u(()=>[e(N,{class:"svg no_margin",name:"shanchu"})]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(D,{"current-page":a(k),"onUpdate:currentPage":d[0]||(d[0]=c=>M(k)?k.value=c:k=c),"page-size":a(S),"onUpdate:pageSize":d[1]||(d[1]=c=>M(S)?S.value=c:S=c),"page-sizes":[3,5,8,10],background:"",layout:"prev, pager, next, jumper,->,sizes,total",total:a(w),onCurrentChange:d[2]||(d[2]=c=>a(I)()),onSizeChange:d[3]||(d[3]=c=>a(I)(1))},null,8,["current-page","page-size","total"])],512),[[ee,a(V)==1]]),X(e(Ue,{ref_key:"spu",ref:m,onControlViewState:i},null,512),[[ee,a(V)==2]]),X(e(we,{ref_key:"sku",ref:J,onControlViewState:i},null,512),[[ee,a(V)==3]]),e(F,{modelValue:a(h),"onUpdate:modelValue":d[4]||(d[4]=c=>M(h)?h.value=c:h=c),title:"SKU列表"},{default:u(()=>[e(v,{data:a(s)},{default:u(()=>[e(t,{label:"SKU名字",prop:"skuName"}),e(t,{label:"SKU价格",prop:"price"}),e(t,{label:"SKU重量",prop:"weight"}),e(t,{label:"SKU图片"},{default:u(({row:c,column:Z,$index:H})=>[Y("img",{src:c.skuDefaultImg,style:{width:"100px"}},null,8,Ae)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}};export{Le as default};
