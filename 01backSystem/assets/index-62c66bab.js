import{I as C,_ as ve,c as ge,b as d,r as J,C as be,d as i,J as he,o as v,e as K,f as l,w as t,g as s,K as U,i as p,n as z,s as x,k as w,t as Q,x as ye,F as we,q as Ce,A as Ve,L as y,p as ke,j as Ue}from"./index-cc972ea5.js";const W=(r,N,c)=>c?C({method:"get",url:`/admin/acl/user/${r}/${N}?username=${c}`}):C({method:"get",url:`/admin/acl/user/${r}/${N}`}),xe=r=>r.id?C({method:"put",url:"/admin/acl/user/update",data:r}):C({method:"post",url:"/admin/acl/user/save",data:r}),Se=r=>C({method:"delete",url:`/admin/acl/user/remove/${r}`}),Ie=r=>C({method:"delete",url:"/admin/acl/user/batchRemove",data:r}),Ae=r=>C({method:"get",url:`/admin/acl/user/toAssign/${r}`}),qe=r=>C({method:"post",url:"/admin/acl/user/doAssignRole",data:r});const R=r=>(ke("data-v-b308e43a"),r=r(),Ue(),r),ze=R(()=>w("span",null,"分配角色",-1)),Re=R(()=>w("span",null,"编辑",-1)),Ne=R(()=>w("span",null,"删除",-1)),De={style:{flex:"auto"}},je=R(()=>w("h4",null,"分配角色",-1)),Be=R(()=>w("br",null,null,-1)),Le={style:{flex:"auto"}},$e={__name:"index",setup(r){let N=ge(),c=d(1),S=d(5),L=d(10),D=d([]),g=d(!1),j=d(),n=J({id:null,name:"",username:"",password:""}),O=d(!1),B=d();be(()=>{b()});const b=async o=>{o&&(c.value=1);let e=await W(c.value,S.value,h.value);e.code==200&&(D.value=e.data.records,L.value=e.data.total)},X=()=>{g.value=!0,j.value="添加用户",Object.assign(n,{id:null,name:"",username:"",password:""}),Ve(()=>{B.value.resetFields()})},Y=async o=>{let e=await Se(o.id);e.code==200?(y({type:"success",message:"删除成功"}),D.value.length<=1&&(c.value-=1),b()):y({type:"error",message:"删除失败:"+e.data})};let $=d([]);const Z=(o,e)=>{$.value=o.map((u,f,m)=>u.id)},ee=async()=>{(await Ie($.value)).code==200?(y({type:"success",message:"批量删除成功"}),b()):y({type:"error",message:"批量删除失败"})},le=o=>{g.value=!0,j.value="更新用户",Object.assign(n,o),O.value=o.username===N.userData.name,B.value.resetFields()},ae=async()=>{await B.value.validate();let o=await xe(n);o.code==200?(y({type:"success",message:n.id?"修改成功":"添加成功"}),b(n.id?null:1),O.value&&window.localtion.reload()):y({type:"error",message:(n.id?"修改失败:":"添加失败:")+o.data}),g.value=!1},te=()=>{g.value=!1};let se=J({name:[{required:!0,trigger:"blur",validator:(o,e,u)=>{e.trim().length<5?u(new Error("姓名不能少于5")):u()}}],username:[{required:!0,trigger:"blur",validator:(o,e,u)=>{e.trim().length<5?u(new Error("昵称不能少于5")):u()}}],password:[{required:!0,trigger:"blur",validator:(o,e,u)=>{e.trim().length<6?u(new Error("密码不能少于6")):u()}}]}),V=d(!1),oe=async o=>{V.value=!0,Object.assign(n,o);let e=await Ae(o.id);e.code==200&&(k.value=e.data.assignRoles,A.value=e.data.allRolesList)},I=d(!1),E=d(!0),k=d(["2","4"]),A=d(["1","2","3","4"]),re=()=>{k.value=I.value?A.value:[],E.value=!1},ne=o=>{const e=o.length;I.value=e===A.value.length,E.value=e>0&&e<A.value.length};const ue=()=>{V.value=!1},de=async()=>{(await qe({roleIdList:k.value.map((e,u,f)=>e.id),userId:n.id})).code==200?(y({type:"success",message:"分配角色成功"}),b()):y({type:"error",message:"分配角色失败"}),V.value=!1};let h=d();const ie=async()=>{let o=await W(c.value,S.value,h.value);o.code==200&&(D.value=o.data.records,L.value=o.data.total)},me=()=>{h.value=null,b(1)};return(o,e)=>{const u=i("el-input"),f=i("el-form-item"),m=i("el-button"),F=i("el-form"),P=i("el-card"),_=i("el-table-column"),T=i("SvgIcon"),ce=i("el-popconfirm"),pe=i("el-table"),fe=i("el-pagination"),M=i("el-drawer"),G=i("el-checkbox"),_e=i("el-checkbox-group"),q=he("hasAccess");return v(),K("div",null,[l(P,null,{default:t(()=>[l(F,{class:"form"},{default:t(()=>[l(f,{label:"用户名:"},{default:t(()=>[l(u,{placeholder:"请输入搜索的用户名",modelValue:s(h),"onUpdate:modelValue":e[0]||(e[0]=a=>U(h)?h.value=a:h=a),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(f,null,{default:t(()=>[l(m,{type:"primary",onClick:ie,disabled:!s(h)},{default:t(()=>[p("搜索")]),_:1},8,["disabled"]),l(m,{onClick:me},{default:t(()=>[p("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(P,{style:{"margin-top":"10px"}},{default:t(()=>[z((v(),x(m,{type:"primary",onClick:X},{default:t(()=>[p("添加用户")]),_:1})),[[q,"btn.User.add"]]),z((v(),x(m,{type:"danger",disabled:!s($).length,onClick:ee},{default:t(()=>[p("批量删除")]),_:1},8,["disabled"])),[[q,"btn.User.remove"]]),l(pe,{border:"",data:s(D),style:{margin:"20px 0"},onSelect:Z},{default:t(()=>[l(_,{type:"selection"}),l(_,{type:"index",label:"#",align:"center"}),l(_,{label:"id",align:"center",prop:"id"}),l(_,{label:"用户名字",align:"center",prop:"name"}),l(_,{label:"用户名称",align:"center",prop:"username"}),l(_,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(_,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(_,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(_,{label:"操作",align:"center",width:"300"},{default:t(({row:a,column:Oe,$index:Pe})=>[z((v(),x(m,{size:"small",onClick:H=>s(oe)(a)},{default:t(()=>[l(T,{class:"svg user",name:"user"}),ze]),_:2},1032,["onClick"])),[[q,"btn.User.assgin"]]),z((v(),x(m,{size:"small",type:"primary",onClick:H=>le(a)},{default:t(()=>[l(T,{class:"svg",name:"bianji"}),Re]),_:2},1032,["onClick"])),[[q,"btn.User.update"]]),z((v(),x(ce,{title:"确定删除吗？",onConfirm:H=>Y(a)},{reference:t(()=>[l(m,{size:"small",type:"danger"},{default:t(()=>[l(T,{class:"svg",name:"shanchu"}),Ne]),_:1})]),_:2},1032,["onConfirm"])),[[q,"btn.User.remove"]])]),_:1})]),_:1},8,["data"]),l(fe,{"current-page":s(c),"onUpdate:currentPage":e[1]||(e[1]=a=>U(c)?c.value=a:c=a),"page-size":s(S),"onUpdate:pageSize":e[2]||(e[2]=a=>U(S)?S.value=a:S=a),"page-sizes":[5,10,30,50],background:!0,layout:" prev, pager, next, jumper,->,sizes,total",total:s(L),onSizeChange:e[3]||(e[3]=a=>b(1)),onCurrentChange:e[4]||(e[4]=a=>b())},null,8,["current-page","page-size","total"])]),_:1}),l(M,{modelValue:s(g),"onUpdate:modelValue":e[8]||(e[8]=a=>U(g)?g.value=a:g=a)},{header:t(()=>[w("h4",null,Q(s(j)),1)]),default:t(()=>[l(F,{model:s(n),rules:s(se),ref_key:"formRef",ref:B},{default:t(()=>[l(f,{label:"用户姓名",prop:"name"},{default:t(()=>[l(u,{modelValue:s(n).name,"onUpdate:modelValue":e[5]||(e[5]=a=>s(n).name=a),placeholder:"请输入用户的姓名"},null,8,["modelValue"])]),_:1}),l(f,{label:"用户昵称",prop:"username"},{default:t(()=>[l(u,{modelValue:s(n).username,"onUpdate:modelValue":e[6]||(e[6]=a=>s(n).username=a),placeholder:"请输入用户的昵称"},null,8,["modelValue"])]),_:1}),s(j)=="添加用户"?(v(),x(f,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(u,{modelValue:s(n).password,"onUpdate:modelValue":e[7]||(e[7]=a=>s(n).password=a),placeholder:"请输入用户的密码"},null,8,["modelValue"])]),_:1})):ye("",!0)]),_:1},8,["model","rules"])]),footer:t(()=>[w("div",De,[l(m,{onClick:te},{default:t(()=>[p("取消")]),_:1}),l(m,{type:"primary",onClick:ae},{default:t(()=>[p("确定")]),_:1})])]),_:1},8,["modelValue"]),l(M,{modelValue:s(V),"onUpdate:modelValue":e[12]||(e[12]=a=>U(V)?V.value=a:V=a)},{header:t(()=>[je]),default:t(()=>[l(F,{"label-width":"100"},{default:t(()=>[l(f,{label:"用户名"},{default:t(()=>[l(u,{disabled:!0,modelValue:s(n).username,"onUpdate:modelValue":e[9]||(e[9]=a=>s(n).username=a)},null,8,["modelValue"])]),_:1}),l(f,{label:"职位列表",class:"lineFeed"},{default:t(()=>[l(G,{modelValue:s(I),"onUpdate:modelValue":e[10]||(e[10]=a=>U(I)?I.value=a:I=a),indeterminate:s(E),onChange:s(re)},{default:t(()=>[p("全选")]),_:1},8,["modelValue","indeterminate","onChange"]),Be,l(_e,{modelValue:s(k),"onUpdate:modelValue":e[11]||(e[11]=a=>U(k)?k.value=a:k=a),onChange:s(ne)},{default:t(()=>[(v(!0),K(we,null,Ce(s(A),a=>(v(),x(G,{key:a,label:a},{default:t(()=>[p(Q(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1})]),footer:t(()=>[w("div",Le,[l(m,{onClick:ue},{default:t(()=>[p("取消")]),_:1}),l(m,{type:"primary",onClick:de},{default:t(()=>[p("确定")]),_:1})])]),_:1},8,["modelValue"])])}}},Ge=ve($e,[["__scopeId","data-v-b308e43a"]]);export{Ge as default};
