import{I as k,_ as le,b as c,C as te,r as D,d as i,o as ae,e as oe,f as l,w as t,g as o,K as C,M as se,i as m,t as ne,k as $,L as h,p as re,j as de}from"./index-cc972ea5.js";const ie=(s,u,_)=>_?k({method:"get",url:`/admin/acl/role/${s}/${u}?roleName=${_}`}):k({method:"get",url:`/admin/acl/role/${s}/${u}`}),ue=s=>s.id?k({method:"put",url:"/admin/acl/role/update",data:s}):k({method:"post",url:"/admin/acl/role/save",data:s}),ce=s=>k({method:"delete",url:`/admin/acl/role/remove/${s}`}),pe=s=>k({method:"get",url:`/admin/acl/permission/toAssign/${s}`}),me=(s,u)=>k({method:"post",url:`/admin/acl/permission/doAssign?roleId=${s}&permissionId=${u}`});const E=s=>(re("data-v-caea45d8"),s=s(),de(),s),_e=E(()=>$("span",null,"添加职位",-1)),fe=E(()=>$("h4",null,"分配权限",-1)),ge={style:{flex:"auto"}},ve={__name:"index",setup(s){let u=c(1),_=c(10),z=c(11),v=c(),w=c([]),f=c(!1);te(()=>{g()});let g=async r=>{r&&(u.value=1);let e=await ie(u.value,_.value,v.value);e.code==200&&(w.value=e.data.records,z.value=e.data.total)};const K=()=>{v.value="",g()};let x=c(),d=D({id:null,roleName:null});const A=D({roleName:[{required:!0,trigger:"blur",validator:(r,e="",n)=>{e?e.trim().length<=2&&n(new Error("长度不小于2")):n(new Error("不能为空")),n()}}]}),F=()=>{f.value=!0,Object.assign(d,{id:null,roleName:null}),x.value.resetFields()},L=r=>{f.value=!0,Object.assign(d,r),x.value.resetFields()},O=()=>{f.value=!1},B=async()=>{await x.value.validate(),(await ue(d)).code==200?(h({type:"success",message:d.id?"修改成功":"添加成功"}),g(d.id?null:1)):h({type:"error",message:d.id?"修改失败":"添加失败"}),f.value=!1},G=async r=>{(await ce(r.id)).code==200?(h({type:"success",message:"删除成功"}),w.value.length<=1&&(u.value-=1),g()):h({type:"error",message:"删除失败"})};let I=c([]),S=c([]),y=c(!1),M=async r=>{y.value=!0,Object.assign(d,r);let e=await pe(d.id);e.code==200&&(I.value=e.data,S.value=U(I.value,[]))};const U=(r,e)=>(r.forEach(n=>{n.select&&n.children.length<=0&&e.push(n.id),n.children&&n.children.length>0&&U(n.children,e)}),e),T=()=>{y.value=!1};let N=c();const H=async()=>{let r=N.value.getCheckedKeys(),e=N.value.getHalfCheckedKeys(),n=[...r,...e];(await me(d.id,n)).code==200?h({type:"success",message:"修改成功"}):h({type:"error",message:"修改失败"}),y.value=!1},J={children:"children",label:"name"};return(r,e)=>{const n=i("el-input"),V=i("el-form-item"),p=i("el-button"),q=i("el-form"),j=i("el-card"),R=i("SvgIcon"),b=i("el-table-column"),Q=i("el-popconfirm"),W=i("el-table"),X=i("el-pagination"),Y=i("el-dialog"),Z=i("el-tree"),ee=i("el-drawer");return ae(),oe("div",null,[l(j,null,{default:t(()=>[l(q,{class:"form"},{default:t(()=>[l(V,{label:"职位搜索"},{default:t(()=>[l(n,{placeholder:"请输入职位",modelValue:o(v),"onUpdate:modelValue":e[0]||(e[0]=a=>C(v)?v.value=a:v=a),onKeydown:e[1]||(e[1]=se(a=>o(g)(1),["enter"]))},null,8,["modelValue"])]),_:1}),l(V,null,{default:t(()=>[l(p,{type:"primary",disabled:!o(v),onClick:e[2]||(e[2]=a=>o(g)(1))},{default:t(()=>[m("搜索")]),_:1},8,["disabled"]),l(p,{onClick:K},{default:t(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(j,{style:{"margin-top":"20px"}},{default:t(()=>[l(p,{type:"primary",onClick:F},{default:t(()=>[l(R,{class:"svg",name:"add"}),_e]),_:1}),l(W,{class:"role",border:"",style:{margin:"20px 0"},data:o(w)},{default:t(()=>[l(b,{type:"index",label:"#"}),l(b,{label:"ID",prop:"id"}),l(b,{label:"职位名称",prop:"roleName"}),l(b,{label:"创建时间",prop:"createTime"}),l(b,{label:"更新时间",prop:"updateTime"}),l(b,{label:"操作",width:"300"},{default:t(({row:a,column:ke,$index:be})=>[l(p,{size:"small",onClick:P=>o(M)(a)},{default:t(()=>[l(R,{class:"svg black",name:"user"}),m(" 分配权限 ")]),_:2},1032,["onClick"]),l(p,{size:"small",type:"primary",onClick:P=>L(a)},{default:t(()=>[l(R,{class:"svg",name:"bianji"}),m(" 编辑 ")]),_:2},1032,["onClick"]),l(Q,{title:"确定删除吗?",onConfirm:P=>G(a)},{reference:t(()=>[l(p,{size:"small",type:"danger"},{default:t(()=>[l(R,{class:"svg",name:"shanchu"}),m(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),l(X,{"current-page":o(u),"onUpdate:currentPage":e[3]||(e[3]=a=>C(u)?u.value=a:u=a),"page-size":o(_),"onUpdate:pageSize":e[4]||(e[4]=a=>C(_)?_.value=a:_=a),"page-sizes":[10,20,30,40],background:!0,layout:" prev, pager, next, jumper,->,sizes,total",total:o(z),onSizeChange:e[5]||(e[5]=a=>o(g)(1)),onCurrentChange:e[6]||(e[6]=a=>o(g)())},null,8,["current-page","page-size","total"])]),_:1}),l(Y,{modelValue:o(f),"onUpdate:modelValue":e[8]||(e[8]=a=>C(f)?f.value=a:f=a)},{header:t(()=>[m(ne(o(d).id?"修改职位":"添加职位"),1)]),footer:t(()=>[l(p,{onClick:O},{default:t(()=>[m("取消")]),_:1}),l(p,{type:"primary",onClick:B},{default:t(()=>[m("确定")]),_:1})]),default:t(()=>[l(q,{model:o(d),rules:A,ref_key:"RefForm",ref:x},{default:t(()=>[l(V,{label:"职位名称",prop:"roleName"},{default:t(()=>[l(n,{modelValue:o(d).roleName,"onUpdate:modelValue":e[7]||(e[7]=a=>o(d).roleName=a),placeholder:"请输入职位名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(ee,{modelValue:o(y),"onUpdate:modelValue":e[9]||(e[9]=a=>C(y)?y.value=a:y=a)},{header:t(()=>[fe]),default:t(()=>[l(Z,{data:o(I),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":o(S),props:J,ref_key:"tree",ref:N},null,8,["data","default-checked-keys"])]),footer:t(()=>[$("div",ge,[l(p,{onClick:T},{default:t(()=>[m("取消")]),_:1}),l(p,{type:"primary",onClick:H},{default:t(()=>[m("确定")]),_:1})])]),_:1},8,["modelValue"])])}}},Ce=le(ve,[["__scopeId","data-v-caea45d8"]]);export{Ce as default};
